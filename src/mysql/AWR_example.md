## MySQL AWR in action

**Sample prompts**:
- Generate a performance report using mysql-awr
- Model Claude Sonnet 4.5 (Thinking)

Here is an example of a performance report generated by the `mysql-awr` tool, highlighting specific optimization opportunities:

### **Database Configuration**
- **Version**: MariaDB 10.5.2
- **Buffer Pool Size**: 256 MB
- **Max Connections**: 100
- **Table Open Cache**: 400
- **Query Cache**: Enabled (64 MB)

### **Performance Metrics**

#### **InnoDB Buffer Pool**
- **Hit Ratio**: 99.94% ‚úÖ (Excellent - most reads from memory)
- **Read Requests**: 11.3M
- **Physical Reads**: 6,278

#### **Table Cache**
- **Hit Ratio**: 68.02% ‚ö†Ô∏è (Low - tables are being opened frequently)
- **Cache Hits**: 8,135
- **Cache Misses**: 3,824

#### **Temporary Tables**
- **Total Created**: 1,119
- **Created on Disk**: 459 (41.02%) ‚ö†Ô∏è (High - indicates memory pressure)

### **Top Queries by Execution Time**

#### **1. Ticket Statistics by Time Period** (0.76s)
```sql
SELECT FROM_UNIXTIME(UNIX_TIMESTAMP(glpi_tickets_distinct.date), ?) AS PERIOD, 
       SUM(IF(glpi_tickets_distinct.status = ?, ...)) ...
FROM (SELECT DISTINCTROW glpi_tickets.* FROM glpi_tickets 
      WHERE glpi_tickets.is_deleted = ?) AS glpi_tickets_distinct
GROUP BY period ORDER BY period ASC
```
- **Rows Examined**: 33,004
- **Rows Returned**: 156
- **Issues**: Full table scan, disk temp table, no index used
- **Optimization**: Add index on `(is_deleted, date)`

#### **2. Ticket Categorization Report** (0.47s)
```sql
SELECT glpi_itilcategories.completename, COUNT(DISTINCTROW(glpi_tickets.id)) 
FROM glpi_tickets 
LEFT JOIN glpi_itilcategories ON glpi_itilcategories.id = glpi_tickets.itilcategories_id
WHERE glpi_tickets.is_deleted = ?
GROUP BY glpi_itilcategories.completename
```
- **Rows Examined**: 16,502
- **Optimization**: Add composite index on `(is_deleted, itilcategories_id)`

### **Recommendations**

1. **Increase Temporary Table Memory** üî¥ **High Priority**
   - Current: 41% of temp tables spill to disk
   - Action: Increase `tmp_table_size` and `max_heap_table_size` to 64-128MB

2. **Expand Table Open Cache** üü° **Medium Priority**
   - Current hit ratio: 68%
   - Action: Increase `table_open_cache` from 400 to at least 1000

3. **Add Missing Indexes** üî¥ **High Priority**
   ```sql
   ALTER TABLE glpi_tickets ADD INDEX idx_deleted_date (is_deleted, date);
   ALTER TABLE glpi_tickets ADD INDEX idx_deleted_category (is_deleted, itilcategories_id);
   ```
